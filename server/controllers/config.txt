export const getUsersForSidebar = async (req , res ) =>{
     try {
        const userId = req.user._Id ; 

        const filteredUsers = await User.find({_id: {$ne: userId}}).select("-password"); //  $ne not equal and then remove password from the result 

        // count number of message not seen 

        const unseenMessages = {};

        const promises = filteredUsers.map( async (user) =>{

            const messages = await Message.find({senderId: user._id , receiverId: userId , seen: false});

            if(messages.length > 0){
                unseenMessages [user._id] = messages.length ;
            }

            // to excute all promisses 
           await Promise.all(promises)


           res.json({success: true , users : filteredUsers , unseenMessages});

        })
        //  // to excute all promisses 
        //    await Promise.all(promises)


        //    res.json({success: true , users : filteredUsers , unseenMessages});


     }catch(error){
          console.log(error.messages);
           res.json({success: false , message: error.message});
     }
 }
